# Media Server Microservice –Ω–∞ Go

## üìÑ –û–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–æ—Å—Ç–æ–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ—Ç–¥–∞—á–∏ —Ñ–∞–π–ª–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:

- –ó–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ `/upload` —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏
- –û—Ç–¥–∞—á–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/public`
- –õ–∏—Å—Ç–∏–Ω–≥–∞ —Ñ–∞–π–ª–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ –ø–æ–∏—Å–∫–æ–º –ø–æ –∏–º–µ–Ω–∏ —á–µ—Ä–µ–∑ `/files`
- –£–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ `/files/:name`
- –ü—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö MIME-—Ç–∏–ø–æ–≤ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è      | –û–ø–∏—Å–∞–Ω–∏–µ                                                                 | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é                        |
|-----------------|--------------------------------------------------------------------------|------------------------------------|
| `UPLOAD_DIR`    | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤                                            | `./public`                          |
| `PORT`          | –ü–æ—Ä—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å                                        | `8080`                              |
| `PAGE_LIMIT`    | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏ –ª–∏—Å—Ç–∏–Ω–≥–µ                                 | `20`                                |
| `FILE_MAX_SIZE` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö                                         | `104857600` (100 MB)                |
| `FILE_FILTER`   | –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤ –ø–æ –∏–º–µ–Ω–∏                        | `.*`                                |
| `ALLOWED_MIMES` | –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ MIME-—Ç–∏–ø—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)                                      | `image/jpeg,image/png,video/mp4`    |

---

## üöÄ –ó–∞–ø—É—Å–∫ —Å Docker

1. –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑:

```bash
docker build -t media-server .
````

2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

```bash
docker run -d -p 8080:8080 \
  -e UPLOAD_DIR=/app/public \
  -e PORT=8080 \
  -e PAGE_LIMIT=20 \
  -e FILE_MAX_SIZE=104857600 \
  -e FILE_FILTER=".*\.(jpg|jpeg|png|mp4)$" \
  -e ALLOWED_MIMES="image/jpeg,image/png,video/mp4" \
  -v $(pwd)/public:/app/public \
  media-server
```

---

## üì¶ API

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞

**POST** `/upload`
`multipart/form-data` —Å –∫–ª—é—á–æ–º `file`

**–ü—Ä–∏–º–µ—Ä —Å curl:**

```bash
curl -X POST http://localhost:8080/upload -F "file=@path/to/file.jpg"
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "file": "/public/550e8400-e29b-41d4-a716-446655440000.jpg"
}
```

---

### 2. –õ–∏—Å—Ç–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ –ø–æ–∏—Å–∫–æ–º

**GET** `/files?page=1&search=keyword`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

* `page` ‚Äî –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
* `search` ‚Äî –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ü—Ä–∏–º–µ—Ä:**

```bash
curl "http://localhost:8080/files?page=1&search=logo"
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "files": ["/public/logo.png"],
  "total": 1
}
```

---

### 3. –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞

**DELETE** `/files/:name`

**–ü—Ä–∏–º–µ—Ä:**

```bash
curl -X DELETE http://localhost:8080/files/550e8400-e29b-41d4-a716-446655440000.jpg
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "deleted": true,
  "file": "/public/550e8400-e29b-41d4-a716-446655440000.jpg"
}
```

---

### 4. –î–æ—Å—Ç—É–ø –∫ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º —Ñ–∞–π–ª–∞–º

–§–∞–π–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ URL:

```
/public/{file_name}
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ MIME-—Ç–∏–ø–æ–≤ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤
* –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–º—ë–Ω —Ñ–∞–π–ª–æ–≤
* –ó–∞—â–∏—Ç–∞ –æ—Ç `directory traversal` –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏

